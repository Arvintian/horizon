openapi: 3.0.1
info:
  title: Horizon-Pipelinerun-Restful
  version: 1.0.0
servers:
  - url: 'http://localhost:8080/'
paths:
  /apis/core/v1/pipelineruns/{pipelinerunID}/stop:
    parameters:
      - name: pipelinerunID
        in: query
        description: the pipelinerun ID
        required: true
    post:
      tags:
        - pipelinerun
      operationId: stopPipelinerun
      summary: |
        Stop the running pipelinerun for a cluster.
        If there is no running pipelinerun, do nothing and return success.
        A cluster can only have one running pipelinerun.
      responses:
        "200":
          description: Success
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: "common.yaml#/components/schemas/Error"

  /apis/core/v1/pipelineruns/{pipelinerunID}/log:
    parameters:
      - name: pipelinerunID
        in: query
        description: the pipelinerun ID
        required: true
    get:
      tags:
        - pipelinerun
      operationId: getPipelineRunLog
      summary: |
        Get the specified pipelinerun's log for a cluster.
      responses:
        "200":
          description: Success
          content:
            text/plain:
              schema:
                example: |
                  xxxxxxxxxxxx
                  xxxxxxxxxxxx
                  xxxxxxxxxxxx
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: "common.yaml#/components/schemas/Error"

  /apis/core/v1/pipelineruns/{pipelinerunID}/status:
    parameters:
      - name: pipelinerunID
        in: query
        description: the pipelinerun ID
        required: true
    get:
      tags:
        - pipelinerun
      operationId: getPipelinerunsStatus
      summary: |
        Get the specified pipelinerun's status for a cluster.
      responses:
        "200":
          description: Success
          content:
            application/json:
              schema:
                example: |
                  {
                      "data":{
                          "id":1,
                          "//status":"running/ok/failed/cancelled",
                          "status":"ok",
                          "//action":"builddeploy/deploy/rollback/restart",
                          "action":"builddeploy",
                          "title":"v1.0版本发布",
                          "description":"This is a beautiful description",
                          "//codeBranch":"code_branch and code_commit exists only when action is buildAndDeploy",
                          "codeBranch":"develop",
                          "codeCommit":"239b7aeedc1d2b3023871a85d1cd2b11590c6ba9",
                          "//configCommit":"cluster config commit",
                          "configCommit":"0ae7266acc62d7c2bacd74e3f0ef3edacc04c459",
                          "//rollbackFrom":"pipelinerun this pipelinerun rollback from",
                          "rollbackFrom":1000,
                          "createdBy":"Tony",
                          "//startedAt":"unix timestamp",
                          "startedAt":1634182718327,
                          "//finishedAt":"unix timestamp",
                          "finishedAt":163418378923
                      }
                  }
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: "common.yaml#/components/schemas/Error"

  /apis/core/v1/pipelineruns/{pipelinerunID}/diffs:
    parameters:
      - name: pipelinerunID
        in: query
        description: the pipelinerun ID
        required: true
      get:
        tags:
          - pipelinerun
      operationId: getPipelineRunDiff
      summary: |
        Get the specified pipelinerun's diff for a cluster.
      responses:
        "200":
          description: Success
          content:
            application/json:
              schema:
                example: |
                  {
                      "data":{
                          "codeInfo":{
                              "Branch": "master"
                              "CommitMsg": "last commit msg"
                              "CommitID":"6cb5e13a2d3c59f2283fc6b52771729691aa9fc3"
                              "Link": https://g.hz.netease.com/music-cloud-native/horizon/horizon/-/commits/feature/applications
                          },
                          "configDiff ": {
                            "from": "6cb5e13a2d3c59f2283fc6b52771729691aa9fc3"
                            "to": "6cb5e13a2d3c59f2283fc6b52771729691aa9fc3"
                            "diff":"@@ -1,7 +1,7 @@\n metadata:\n   name: web-api\n   namespace: music-cicd\n-  charVersion: v2.7.3\n+  charVersion: v2.7.4\n \n replicaCount: 2\n \n"
                          }
                      }
                  }